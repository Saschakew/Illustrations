<h2 class="text-center mb-4">Estimation and Identification with Restrictions</h2>

<!-- Interactive Controls -->
<div id="simulation-controls" class="controls-container card mb-4">
    <div class="card-body">
        <div class="controls-row">
            <div class="control-item sample-size">
                <label for="phi-slider" class="form-label mb-0 me-2"> \( \phi =\)  <span class="phi-value-display">0.00</span></label>
                <input type="range" class="form-range" id="phi-slider" min="-1.5707" max="1.5707" step="0.01" value="0">
            </div>
            <div class="control-item phi-toggle">
                <div class="phi-toggle-pill">
                    <span class="phi-label phi-label-left">Recursive</span>
                    <label class="custom-switch">
                        <input type="checkbox" id="phiSwitch" title="Switch between Recursive and Non-recursive models">
                        <span class="slider"></span>
                    </label>
                    <span class="phi-label phi-label-right">Non-recursive</span>
                </div>
            </div>
            <div class="control-item new-sample">
                <button id="newSampleBtn" class="btn w-100 new-sample-btn">New Sample</button>
            </div>
        </div>
    </div>
</div>

<div id="controls-placeholder"></div>

<!-- Explanation Section -->
<div class="explanation-section mb-4">
    <p>
        In the SVAR model, we estimate the reduced-form shocks, \( u_t \), but we are truly interested in the underlying structural shocks, \( \epsilon_t \). The relationship is given by \( u_t = B_0 \epsilon_t \). From the data \( u_t \), we can estimate the covariance matrix \( \Sigma_u = E(u_t u_t') \). The theoretical relationship is \( \Sigma_u = B_0 B_0' \) since \( E(\epsilon_t \epsilon_t') = I \).
    </p>
    <p>
        The sample covariance matrix, \( \hat{\Sigma}_u \), is our estimate of \( \Sigma_u \). We can decompose it using the Cholesky decomposition: \( \hat{\Sigma}_u = \hat{P} \hat{P}' \), where \( \hat{P} \) is a lower triangular matrix. This \( \hat{P} \) is one possible estimate for \( B_0 \).
    </p>
    <p>
        However, any matrix \( \hat{B}_0 = \hat{P} R \), where \( R \) is an orthonormal rotation matrix (i.e., \( RR' = I \)), is also a valid candidate, since \( \hat{B}_0 \hat{B}_0' = \hat{P} R R' \hat{P}' = \hat{P} \hat{P}' = \hat{\Sigma}_u \). In the 2-variable case, this rotation matrix is defined by a single angle \( \phi \):
        \[ R(\phi) = \begin{pmatrix} \cos(\phi) & -\sin(\phi) \\ \sin(\phi) & \cos(\phi) \end{pmatrix} \]
        Our goal is to find the correct rotation \( \phi \) that recovers the true \( B_0 \).
    </p>
</div>





<!-- Matrix Display -->
<div class="row text-center mb-4">
    <div class="col-md-4">
        <h5>Sample Covariance \( \hat{\Sigma}_u \)</h5>
        <div id="sigma-u-hat-matrix-display" class="matrix-display"></div>
    </div>
    <div class="col-md-4">
        <h5>Cholesky Factor \( \hat{P} \)</h5>
        <div id="p-hat-matrix-display" class="matrix-display"></div>
    </div>
    <div class="col-md-4">
        <h5>Estimated \( \hat{B}_0(\phi) \)</h5>
        <div id="b-hat-matrix-display" class="matrix-display"></div>
    </div>
</div>

<!-- Plots Section -->
<div class="row">
    <div class="col-lg-6">
        <div class="plot-container">
            <h5 class="text-center">Estimated Structural Shocks \( \hat{\epsilon}_t(\phi) \) vs True Shocks \( \epsilon_t \)</h5>
            <div id="innovations-scatter-plot-er" class="plotly-chart"></div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="plot-container">
            <h5 class="text-center">Correlation between Estimated Shocks</h5>
            <div id="correlation-plot-er" class="plotly-chart"></div>
        </div>
    </div>
</div>